{
  "ignition": {
    "version": "3.3.0"
  },
  "kernelArguments": {
    "shouldExist": [
      "spectre_v2=on",
      "spec_store_bypass_disable=on",
      "l1tf=full,force",
      "mds=full,nosmt",
      "tsx=off",
      "tsx_async_abort=full,nosmt",
      "kvm.nx_huge_pages=force",
      "nosmt=force",
      "l1d_flush=on",
      "mmio_stale_data=full,nosmt",
      "random.trust_bootloader=off",
      "random.trust_cpu=off",
      "intel_iommu=on",
      "amd_iommu=on",
      "iommu.passthrough=0 iommu.strict=1",
      "slab_nomerge",
      "init_on_alloc=1",
      "init_on_free=1",
      "pti=on",
      "vsyscall=none",
      "page_alloc.shuffle=1",
      "randomize_kstack_offset=on",
      "extra_latent_entropy",
      "debugfs=off"
    ]
  },
  "passwd": {
    "users": [
      {
        "groups": [
          "docker",
          "sudo"
        ],
        "name": "kp9001",
        "sshAuthorizedKeys": [
          "sk-ssh-ed25519@openssh.com AAAAGnNrLXNzaC1lZDI1NTE5QG9wZW5zc2guY29tAAAAIC1UQ0EQoa05ZkMHBEm++bIRTfWHf3M+XYzGrGMplqUhAAAAC3NzaDp0ZXJtaXVz Generated By Termius",
          "sk-ssh-ed25519@openssh.com AAAAGnNrLXNzaC1lZDI1NTE5QG9wZW5zc2guY29tAAAAIPVSoRjKO3rnrh1+u/K9yxg3g1pFMc+H2g49aVloBgiMAAAAC3NzaDp0ZXJtaXVz Generated By Termius",
          "ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBMi4zESvbZnVo7gT8UsSNzGLW6ItK+8w1mOpr/xtvaeJNuaCHMfuFnU5JA1fbqvTw3cLm0XbgYgpoLscxoEPG8s="
        ]
      }
    ]
  },
  "storage": {
    "files": [
      {
        "path": "/etc/zincati/config.d/51-rollout-wariness.toml",
        "contents": {
          "compression": "",
          "source": "data:,%5Bidentity%5D%0Arollout_wariness%20%3D%200%0A"
        }
      },
      {
        "path": "/etc/zincati/config.d/55-updates-strategy.toml",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/2SOsQqDQAyG9zxFyFzEqZSCa7dOLXSQQw4v6IHm5Mwh9ulLBKdOH/nzky9tWYJXXh2smr3ysGODtHCOKcSe4NxXZ+RA48zdNwlbc0q9nywhaP+61RYlpM05CH5fscEW6ZmELkjvwoYPh2Mai+GRo+Hl9UARQvvLZ+1MYb7bva4JJpZBx26OUpTt8LWGXwAAAP//VN/RrsoAAAA="
        }
      },
      {
        "path": "/etc/docker/daemon.json",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/7yPwQqDMBBE735FyNmQu+Ch31F62NpYxZiE3Y2lFP+9RG1Rj6V4CWTn7czOKxNCCHkzNUTLCqPjtjeyEBKjo0rRkxghyHzmFp1kIebNz3SFrqVJDsBNctQDoI6E1ldg9bV1elpcvNduKeOE9xRz3ogToFSwwLXHvtyet6Oc4YfHrmw8sdwAl+9vzPc1AiNU5tAWS+QfS3RDf2iDlPf7+dn8jtk7AAD//8zPuZeOAgAA"
        }
      }
    ],
    "links": [
      {
        "path": "/etc/localtime",
        "target": "../usr/share/zoneinfo/UTC"
      },
      {
        "path": "/etc/systemd/system/multi-user.target.wants/unbound.service",
        "target": "/usr/lib/systemd/system/unbound.service"
      },
      {
        "path": "/etc/systemd/system/multi-user.target.wants/tuned.service",
        "target": "/usr/lib/systemd/system/tuned.service"
      },
      {
        "path": "/etc/systemd/system/kdump.service.target",
        "target": "/dev/null"
      }
    ]
  },
  "systemd": {
    "units": [
      {
        "contents": "[Unit]\nDescription=Initial System Setup\nAfter=systemd-machine-id-commit.service\nAfter=network-online.target\nBefore=zincati.service\nConditionPathExists=!/var/lib/%N.stamp\n\n[Service]\nType=oneshot\nRemainAfterExit=yes\nExecStart=/usr/bin/sed -i 's/#DNSSEC=no/DNSSEC=yes/g' /etc/systemd/resolved.conf\nExecStart=/usr/bin/systemctl restart systemd-resolved\nExecStart=/usr/bin/rpm-ostree install docker-compose firewalld qemu-guest-agent tuned unbound vim tmux \nExecStart=/usr/bin/rpm-ostree override remove cifs-utils samba-common-libs samba-client-libs libsmbclient libwbclient samba-common sssd-krb5-common sssd-ipa sssd-nfs-idmap sssd-ldap sssd-client sssd-ad sssd-common sssd-krb5 sssd-common-pac\nExecStart=/usr/bin/sed -i 's/nullok//g' /etc/pam.d/system-auth\nExecStart=/usr/bin/mkdir -p /etc/ssh/sshd_config.d\nExecStart=/usr/bin/mkdir -p /etc/systemd/system/NetworkManager.service.d\nExecStart=/usr/bin/mkdir -p /etc/systemd/system/irqbalance.service.d\nExecStart=/usr/bin/mkdir -p /etc/systemd/system/unbound.service.d\nExecStart=/usr/bin/mkdir -p /etc/security/limits.d\nExecStart=/usr/bin/mkdir -p /etc/unbound\nExecStart=/usr/bin/mkdir -p /etc/tuned\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/ssh/sshd_config.d/10-custom.conf -o /etc/ssh/sshd_config.d/10-custom.conf\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/modprobe.d/30_security-misc.conf -o /etc/modprobe.d/30_security-misc.conf\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/sysctl.d/30_security-misc.conf -o /etc/sysctl.d/30_security-misc.conf\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/sysctl.d/30_silent-kernel-printk.conf -o /etc/sysctl.d/30_silent-kernel-printk.conf\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/sysctl.d/30_security-misc_kexec-disable.conf -o /etc/sysctl.d/30_security-misc_kexec-disable.conf\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/chrony.conf -o /etc/chrony.conf\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/security/limits.d/30-disable-coredump.conf -o /etc/security/limits.d/30-disable-coredump.conf\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/systemd/zram-generator.conf -o /etc/systemd/zram-generator.conf\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/systemd/system/NetworkManager.service.d/99-brace.conf -o /etc/systemd/system/NetworkManager.service.d/99-brace.conf\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/systemd/system/irqbalance.service.d/99-brace.conf -o /etc/systemd/system/irqbalance.service.d/99-brace.conf\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/systemd/system/unbound.service.d/override.conf -o /etc/systemd/system/unbound.service.d/override.conf\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/unbound/unbound.conf -o /etc/unbound/unbound.conf\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/tuned/active_profile -o /etc/tuned/active_profile\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/tuned/profile_mode -o /etc/tuned/profile_mode\nExecStart=/bin/systemctl disable systemd-resolved\nExecStart=/bin/touch /var/lib/%N.stamp\nExecStart=/bin/systemctl --no-block reboot\n\n[Install]\nWantedBy=multi-user.target\n",
        "enabled": true,
        "name": "postinst.service"
      },
      {
        "contents": "[Unit]\nDescription=Initial System Setup 2\nAfter=network-online.target\nConditionPathExists=!/var/lib/%N.stamp\nConditionPathExists=/var/lib/postinst.stamp\n\n[Service]\nType=oneshot\nRemainAfterExit=yes\nExecStart=/usr/bin/docker run --detach --privileged --name watchtower --restart unless-stopped --runtime=runc -v /var/run/docker.sock:/var/run/docker.sock -v /etc/localtime:/etc/localtime:ro containrrr/watchtower --schedule \"* 15 8 * * *\"\nExecStart=/bin/touch /var/lib/%N.stamp\n\n[Install]\nWantedBy=multi-user.target\n",
        "enabled": true,
        "name": "postinst2.service"
      },
      {
        "contents": "[Unit]\nDescription=Update system configuration on boot\nRequires=network-online.target\nAfter=network-online.target\nConditionPathExists=!/var/lib/postboot-lock.stamp\nConditionPathExists=/var/lib/postinst.stamp\n\n[Service]\nType=oneshot\nRemainAfterExist=yes\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/ssh/sshd_config.d/10-custom.conf -o /etc/ssh/sshd_config.d/10-custom.conf\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/modprobe.d/30_security-misc.conf -o /etc/modprobe.d/30_security-misc.conf\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/sysctl.d/30_security-misc.conf -o /etc/sysctl.d/30_security-misc.conf\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/sysctl.d/30_silent-kernel-printk.conf -o /etc/sysctl.d/30_silent-kernel-printk.conf\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/sysctl.d/30_security-misc_kexec-disable.conf -o /etc/sysctl.d/30_security-misc_kexec-disable.conf\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/chrony.conf -o /etc/chrony.conf\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/security/limits.d/30-disable-coredump.conf -o /etc/security/limits.d/30-disable-coredump.conf\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/systemd/zram-generator.conf -o /etc/systemd/zram-generator.conf\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/systemd/system/NetworkManager.service.d/99-brace.conf -o /etc/systemd/system/NetworkManager.service.d/99-brace.conf\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/systemd/system/irqbalance.service.d/99-brace.conf -o /etc/systemd/system/irqbalance.service.d/99-brace.conf\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/systemd/system/unbound.service.d/override.conf -o /etc/systemd/system/unbound.service.d/override.conf\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/unbound/unbound.conf -o /etc/unbound/unbound.conf\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/tuned/active_profile -o /etc/tuned/active_profile\nExecStart=/usr/bin/curl https://raw.githubusercontent.com/kp9001/server-architecture/main/etc/tuned/profile_mode -o /etc/tuned/profile_mode\nExecStart=/usr/bin/systemctl daemon-reload\n\n[Install]\nWantedBy=multi-user.target\n",
        "enabled": true,
        "name": "postboot.service"
      },
      {
        "contents": "[Service]\nType=oneshot\nExecStart=/usr/sbin/setsebool container_use_cephfs off\nExecStart=/usr/sbin/setsebool virt_use_nfs off\nExecStart=/usr/sbin/setsebool virt_use_samba off\nRemainAfterExit=yes\n[Install]\nWantedBy=multi-user.target\n",
        "enabled": true,
        "name": "setsebool.service"
      },
      {
        "contents": "[Unit]\nDescription=gVisor Update\nRequires=network-online.target\nAfter=network-online.target\nBefore=docker.service\n\n[Service]\nWorkingDirectory=/var/roothome\nType=oneshot\nExecStart=/usr/bin/sleep 5\nExecStart=/usr/bin/curl -O https://storage.googleapis.com/gvisor/releases/release/latest/x86_64/runsc\nExecStart=/usr/bin/curl -O https://storage.googleapis.com/gvisor/releases/release/latest/x86_64/runsc.sha512\nExecStart=/usr/bin/curl -O https://storage.googleapis.com/gvisor/releases/release/latest/x86_64/containerd-shim-runsc-v1\nExecStart=/usr/bin/curl -O https://storage.googleapis.com/gvisor/releases/release/latest/x86_64/containerd-shim-runsc-v1.sha512\nExecStart=/usr/bin/sha512sum -c runsc.sha512 -c containerd-shim-runsc-v1.sha512\nExecStart=/usr/bin/rm -f runsc.sha512 containerd-shim-runsc-v1.sha512\nExecStart=/usr/bin/chmod a+rx runsc containerd-shim-runsc-v1\nExecStart=/usr/bin/mv runsc containerd-shim-runsc-v1 /var/usrlocal/bin\nExecStart=/usr/bin/chcon system_u:object_r:container_runtime_exec_t:s0 /var/usrlocal/bin/runsc\n\n[Install]\nWantedBy=multi-user.target\n",
        "enabled": true,
        "name": "gvisor-updater.service"
      },
      {
        "enabled": true,
        "name": "docker.service"
      },
      {
        "enabled": true,
        "name": "fstrim.timer"
      },
      {
        "enabled": true,
        "name": "systemd-oomd.service"
      },
      {
        "enabled": false,
        "mask": true,
        "name": "rpm-ostree-countme.timer"
      }
    ]
  }
}
